<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <script>
        // 原始数据
        const data = {
            text:"hello world"
        }
        // 存储副作用函数的桶
        const bucket = new Set();
        // 对原始数据的代理
        const obj = new Proxy(data,{
            // 拦截读取操作
            get(target, key){
                // 将activeEffect存储的副作用函数收集到桶里
                if(activeEffect){
                    bucket.add(activeEffect)
                }
                // 返回属性值
                return target[key]
            },
            // 拦截设置操作
            set(target, key, newVal){
                // 设置属性值
                target[key] = newVal
                // 把副作用函数从桶里取出并执行
                bucket.forEach(fn=>fn())
                // 返回true代表设置操作成功
                return true
            }
        })
        // 全局变量用于存储被注册的副作用函数
        let activeEffect;
        // effect用于注册副作用函数
        function effect(fn){
            // 当调用effect注册副作用函数时，将副作用函数fn赋值给activeEffect
            activeEffect = fn;
            // 执行副作用函数
            fn();
        }
        

        effect(()=>{
            console.log("打印");
            document.body.innerText = obj.text
        })

        // 设置一个不存在的属性时
        setTimeout(()=>{
            obj.notExist = "hello vue3";
        },1000)

        

        
    </script>
</body>
</html>